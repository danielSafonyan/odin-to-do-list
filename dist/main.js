(()=>{"use strict";function e(e){return e.toLowerCase().trim().replaceAll(" ","-")}class t{constructor(t){this.title=t,this.id=e(t),this.taskList={}}}class c{constructor(t,c){this.title=t,this.id=e(t),this.isDone=!1,this.projectID=c}}class s{#e="all-tasks";#t=[];constructor(){return null==s.instance&&(s.instance=this),s.instance}subscribe(e){this.#t.push(e)}unsubscribe(e){this.#t.indexOf(e)>-1&&this.#t.splice()}notifyAll(){this.#t.forEach((e=>e.updateCurrentProject(this.#e)))}set currentProjectID(e){this.#e=e,this.notifyAll()}get currentProjectID(){return this.#e}}const r=new s,a=new t("All Tasks");class n{constructor(){return null==n.instance&&(this.cache=JSON.parse(localStorage.getItem("cache")),this.cache||(this.cache={},this.cache[a.id]=a,this.currentProjectID=a.id,this.saveState()),n.instance=this),n.instance}updateCurrentProject(e){this.currentProjectID=e}saveTask(e){this.cache[e.projectID].taskList[e.id]=e,this.saveState()}saveProject(e){this.cache[e.id]=e,this.saveState()}deleteProject(){delete this.cache[r.currentProjectID],this.saveState()}changeIsDoneStatus(e,t,c){this.cache[e].taskList[t].isDone=c,this.saveState()}clearCompletedTasks(e){e.forEach((e=>{delete this.cache[e.projectID].taskList[e.id]})),this.saveState()}saveState(){localStorage.setItem("cache",JSON.stringify(this.cache))}}const i=new n;r.subscribe(i);const l=i;class o{constructor(){return null==o.instance&&(this.currentProjectID="all-tasks",this.taskArea=document.querySelector(".tasks"),this.remainingTasksArea=document.querySelector("#remaining-tasks"),this.projectArea=document.querySelector(".dynamic.project-list"),o.instance=this),o.instance}updateCurrentProject(e){this.currentProjectID=e}addTask(e){const t=document.createElement("div");t.classList.add("task");const c=document.createElement("input");c.setAttribute("type","checkbox"),c.setAttribute("id",e.id),c.setAttribute("project-id",e.projectID),c.checked=e.isDone,t.appendChild(c);const s=document.createElement("label");s.setAttribute("for",e.id);const r=document.createElement("span");r.classList.add("custom-checkbox"),s.appendChild(r),s.append(e.title),t.appendChild(s),t.addEventListener("click",d),this.taskArea.appendChild(t)}removeAllTasks(){document.querySelectorAll(".task").forEach((e=>e.remove()))}renderProjectTasks(){this.removeAllTasks(),Object.values(l.cache[this.currentProjectID].taskList).forEach((e=>this.addTask(e))),document.querySelector(".list-title").innerText=l.cache[this.currentProjectID].title}renderAllProjects(){Object.values(l.cache).forEach((e=>{"all-tasks"!==e.id&&this.renderProject(e)}))}renderAllTasks(){this.removeAllTasks();let e=[];Object.values(l.cache).forEach((t=>{e=e.concat(Object.values(t.taskList))})),e.forEach((e=>this.addTask(e))),document.querySelector(".list-title").innerText=l.cache[this.currentProjectID].title}calculateRemainingTasks(){let e;if("all-tasks"===this.currentProjectID){let t=[];Object.values(l.cache).forEach((e=>{t=t.concat(Object.values(e.taskList))})),e=t.filter((e=>!1===e.isDone)).length}else e=Object.values(l.cache[this.currentProjectID].taskList).filter((e=>!1===e.isDone)).length;this.remainingTasksArea.innerText=e}clearCompletedTasks(e){e.forEach((e=>{document.querySelector(`#${e.id}`).parentElement.remove()}))}renderProject(e){const t=document.createElement("li");t.classList.add("project"),t.setAttribute("id",e.id),t.innerText=e.title,t.addEventListener("click",u),this.projectArea.appendChild(t)}}function u(e){e.preventDefault(),h.currentProjectID!==e.currentTarget.id?(document.querySelector(`#${r.currentProjectID}`).classList.remove("active-project"),document.querySelector(`#${e.currentTarget.id}`).classList.add("active-project"),r.currentProjectID=e.currentTarget.id,h.calculateRemainingTasks(),h.removeAllTasks(),"all-tasks"===r.currentProjectID?h.renderAllTasks():h.renderProjectTasks()):console.log("the same project")}function d(e){e.preventDefault();const t=e.currentTarget.querySelector("input");t.checked=!t.checked;const c=e.currentTarget.querySelector("input").getAttribute("id"),s=e.currentTarget.querySelector("input").getAttribute("project-id");l.cache[s].taskList[c].isDone=t.checked,l.changeIsDoneStatus(s,c,t.checked),h.calculateRemainingTasks()}document.querySelector("#all-tasks").addEventListener("click",u);const h=new o;Object.seal(h),r.subscribe(h);const k=h;document.querySelector("#create-task").addEventListener("submit",(function(e){e.preventDefault();const t=e.target[0],s=new c(t.value,r.currentProjectID);k.addTask(s),l.saveTask(s),k.calculateRemainingTasks(),t.value=""})),document.querySelector("#clear-tasks").addEventListener("click",(function(){let e=[];"all-tasks"===r.currentProjectID?(Object.values(l.cache).forEach((t=>{e=e.concat(Object.values(t.taskList))})),e=e.filter((e=>!0===e.isDone))):(e=Object.values(l.cache[r.currentProjectID].taskList),e=e.filter((e=>!0===e.isDone))),l.clearCompletedTasks(e),k.clearCompletedTasks(e)})),document.querySelector("#create-project").addEventListener("submit",(function(e){e.preventDefault();const c=e.target[0],s=new t(c.value);k.renderProject(s),l.saveProject(s),c.value=""})),document.querySelector("#delete-project").addEventListener("click",(function(){"all-tasks"!==r.currentProjectID&&(l.deleteProject(),document.querySelector(`#${r.currentProjectID}`).remove(),document.querySelector("#all-tasks").classList.add("active-project"),r.currentProjectID="all-tasks",k.calculateRemainingTasks(),k.removeAllTasks(),k.renderAllTasks())})),k.calculateRemainingTasks(),k.renderAllProjects(),k.renderAllTasks()})();